<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PowerShell Script Generator</title>

<style>
    body {
        font-family: Arial, sans-serif;
        background: #f5f5f5;
        margin: 20px;
    }

    h2, h3 {
        margin-top: 20px;
    }

    input, textarea, button {
        font-size: 16px;
        padding: 8px;
        margin: 5px 0;
        box-sizing: border-box;
    }

    input, textarea {
        width: 100%;
    }

    button {
        cursor: pointer;
    }

    .cmd-row {
        display: flex;
        gap: 8px;
        margin-bottom: 8px;
        align-items: center;
    }

    .cmd-number {
        width: 32px;
        text-align: right;
        font-weight: bold;
        color: #555;
        flex-shrink: 0;
    }

    .cmd-row input {
        flex: 1;
    }

    .remove-btn {
        background: #d9534f;
        color: white;
        border: none;
        padding: 0 12px;
    }

    .remove-btn:hover {
        background: #c9302c;
    }

    #generatedCommand {
        height: 220px;
        font-family: Consolas, monospace;
    }
</style>
</head>
<body>

<h2>PowerShell Script Generator for TV Shows</h2>

<label>Show Name:</label>
<input type="text" id="showName" placeholder="e.g. The Expanse">

<label>Season Number:</label>
<input type="number" id="seasonNumber" min="1" placeholder="e.g. 1">

<h3>Commands</h3>

<div id="cmdContainer"></div>

<button onclick="addCommand()">Add Command</button>
<button onclick="generateScript()">Generate Script</button>

<h3>Generated PowerShell Script</h3>
<textarea id="generatedCommand" readonly></textarea><br>
<button onclick="copyToClipboard()">Copy to Clipboard</button>

<script>
function renumberCommands() {
    document.querySelectorAll('.cmd-number').forEach((el, idx) => {
        el.textContent = idx + 1;
    });
}

async function pasteFromClipboardIfEmpty(input) {
    if (input.value.trim() !== '') return;
    try {
        const text = await navigator.clipboard.readText();
        if (text) input.value = text.trim();
    } catch {}
}

function addCommand(value = '') {
    const container = document.getElementById('cmdContainer');

    const row = document.createElement('div');
    row.className = 'cmd-row';

    const number = document.createElement('div');
    number.className = 'cmd-number';

    const input = document.createElement('input');
    input.type = 'text';
    input.className = 'cmdInput';
    input.placeholder = 'Click to paste from clipboard';
    input.value = value;

    input.addEventListener('click', () => pasteFromClipboardIfEmpty(input));

    const removeBtn = document.createElement('button');
    removeBtn.textContent = 'âœ–';
    removeBtn.className = 'remove-btn';
    removeBtn.onclick = () => {
        row.remove();
        renumberCommands();
    };

    row.appendChild(number);
    row.appendChild(input);
    row.appendChild(removeBtn);
    container.appendChild(row);

    renumberCommands();
    row.scrollIntoView({ behavior: 'smooth', block: 'center' });
    input.focus();
}

addCommand();

function generateScript() {
    const showName = document.getElementById('showName').value.trim();
    const seasonNumber = document.getElementById('seasonNumber').value.trim();

    if (!showName || !seasonNumber) {
        alert('Please enter Show Name and Season Number.');
        return;
    }

    const cmds = Array.from(document.querySelectorAll('.cmdInput'))
        .map(i => i.value.trim())
        .filter(Boolean);

    const basePath = `D:\\Torrents\\xfer\\TV\\${showName}\\Season ${seasonNumber}`;

    let script = '';
    script += `New-Item -ItemType Directory -Force -Path "${basePath}"; `;
    script += `Set-Location "${basePath}"`;

    if (cmds.length) {
        script += '; ' + cmds.join('; ');
    }

    script += `; $season = (Get-Item .).Name -replace '\\D',''; `;
    script += `$season = '{0:D2}' -f [int]$season; `;
    script += `$i = 1; `;
    script += `Get-ChildItem -File | Sort-Object Name | ForEach-Object { `;
    script += `$ext = $_.Extension.TrimStart('.'); `;
    script += `$newName = ('S{0}E{1:D2}.{2}' -f $season, $i, $ext); `;
    script += `Rename-Item $_.FullName $newName; `;
    script += `$i++ `;
    script += `}; `;

    script += `rclone copy "${basePath}" "tgcrypt:TV/${showName}/Season ${seasonNumber}" --progress --transfers 30 --disable-http2; `;
    script += `Set-Location (Split-Path "${basePath}" -Parent); `;
    script += `Remove-Item -Recurse -Force "${basePath}"; `;
    script += `Clear-Host; exit`;

    const output = document.getElementById('generatedCommand');
    output.value = script;
    output.scrollIntoView({ behavior: 'smooth', block: 'start' });
}

function copyToClipboard() {
    const textarea = document.getElementById('generatedCommand');
    textarea.select();
    document.execCommand('copy');
    alert('Command copied to clipboard!');
}
</script>

</body>
</html>
